\section{Формирование признаков}
\label{sec:feature_engineering}

\hspace*{1.25cm}Формирование признаков --- это процесс преобразования исходных временных рядов в структурированный набор данных (таблицу), пригодный для обучения моделей машинного обучения. Качество и информативность признаков напрямую влияют на точность и обобщающую способность итоговой модели [6]. На основе анализа, проведенного в Главе 2, был сформирован следующий набор признаков.

\subsection{Календарные и временные признаки}

\hspace*{1.25cm}Эти признаки позволяют модели учитывать зависимости, связанные со временем суток, днем недели и общим течением времени. Они особенно полезны для моделей на основе деревьев решений, таких как CatBoost.

\begin{itemize}
	\item \textbf{Час дня (\texttt{hour})} и \textbf{день недели (\texttt{day\_of\_week})}: категориальные признаки, позволяющие модели улавливать суточные и недельные паттерны.
	\item \textbf{Признак выходного дня (\texttt{is\_weekend})}: бинарный флаг, принимающий значение 1, если день является субботой или воскресеньем, и 0 в противном случае.
	\item \textbf{Временной индекс (\texttt{time\_idx})}: монотонно возрастающая переменная, представляющая собой количество времени (в часах), прошедшее с начала обучающего периода. Этот признак помогает модели аппроксимировать долгосрочный тренд в данных.
\end{itemize}

\subsection{Циклические признаки}

\hspace*{1.25cm}Календарные признаки, такие как час дня или день недели, по своей природе цикличны (после 23:00 идет 00:00). Чтобы донести эту информацию до моделей, особенно нейронных сетей, используются тригонометрические преобразования.

\begin{equation}
	x_{sin} = \sin\left(\frac{2\pi x}{P}\right), \quad x_{cos} = \cos\left(\frac{2\pi x}{P}\right)
\end{equation}
где $x$ — исходное значение (например, час), а $P$ — период цикла (24 для часов, 7 для дней недели). Такой подход преобразует одну переменную в две, представляя ее на единичной окружности.

\subsection{Лаговые признаки (Lag features)}

\hspace*{1.25cm}Лаговые признаки — это значения временного ряда из прошлого, используемые в качестве предикторов для будущих значений. Они являются ключевым способом информирования модели об авторегрессионной структуре данных, выявленной при анализе ACF/PACF. Признак создается путем сдвига временного ряда на $k$ шагов назад:
\begin{equation}
	\text{lag}_k(t) = y(t-k)
\end{equation}
где $y(t-k)$ — значение целевой переменной в момент времени $t-k$.

\hspace*{1.25cm}В данном исследовании для CatBoost-модели использовались лаги: 1, 2, 4, 96, 192, 5760 шагов назад, что соответствует интервалам от 15 секунд до 24 часов. Такой выбор позволяет модели учитывать как непосредственную зависимость от предыдущих значений, так и суточную сезонность (лаг 5760 = 24 часа $\times$ 240 точек/час).

\subsection{Признаки на основе скользящего окна (Rolling-window features)}

\hspace*{1.25cm}Для захвата локальной динамики и структуры временного ряда вычисляются статистические показатели в пределах скользящего окна.

\begin{itemize}
	\item \textbf{Скользящее среднее (\texttt{rolling\_mean})}: сглаживает краткосрочные флуктуации и помогает выявить локальный тренд.
	\item \textbf{Скользящее стандартное отклонение (\texttt{rolling\_std})}: характеризует волатильность (изменчивость) ряда в недавнем прошлом.
\end{itemize}
Размер окна $w$ является гиперпараметром, который выбирается в зависимости от специфики модели и характера данных. В данном исследовании использовались различные наборы параметров для разных типов моделей:

\begin{itemize}
	\item \textbf{Для LSTM-модели}: окна размером 20 и 240 точек данных (соответствующие 5 минутам и 1 часу при 15-секундном интервале);
	\item \textbf{Для CatBoost-модели}: более широкий набор окон --- 4, 96, 192, 1920, 2880, 4320, 5760, 8640 точек данных (от 1 минуты до 36 часов), что позволяет модели улавливать как краткосрочные, так и долгосрочные паттерны.
\end{itemize} 